# Run on a schedule
trigger: none
pr: none

jobs:
- job:  
  displayName: Windows 64
  pool: 
    vmImage: 'windows-latest'
  steps:
  - task: NodeTool@0
    inputs:
      versionSource: 'spec'
      versionSpec: '18.x'
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true
      architecture: 'x64'

  - task: Bash@3
    displayName: Git Clone
    inputs:
      targetType: 'inline'
      script: |
        # Write your commands here      
        git clone -b build https://github.com/zeromq/zeromq.js.git
    
  - task: Bash@3
    inputs:
      targetType: 'inline'
      workingDirectory: zeromq.js
      script: |
        npm install
  
  - task: Bash@3
    inputs:
      targetType: 'inline'
      workingDirectory: zeromq.js
      script: |
        npm run prebuild
  - task: Bash@3
    displayName: ls
    inputs:
      workingDirectory: prebuilds
      targetType: 'inline'
      script: |
        ls  

- job:  
  displayName: Windows 32
  pool: 
    vmImage: 'windows-latest'
  steps:
  - task: NodeTool@0
    inputs:
      versionSource: 'spec'
      versionSpec: '18.x'
      # force32bit: true
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true
      architecture: 'x86'
      
  - task: Bash@3
    displayName: Git Clone
    inputs:
      targetType: 'inline'
      script: |
        # Write your commands here      
        git clone -b build https://github.com/zeromq/zeromq.js.git


  - bash: | 
      npm install
    displayName: Install
    workingDirectory: zeromq.js
    env:
      ARCH: x86  
      npm_config_arch: x86

  - bash: | 
      npm run prebuild
    displayName: Install
    workingDirectory: zeromq.js
    env:
      ARCH: x86  
      npm_config_arch: x86

  - task: Bash@3
    displayName: ls
    inputs:
      workingDirectory: zeromq.js/prebuilds
      targetType: 'inline'
      script: |
        ls  


- job:  
  displayName: Mac 64
  pool: 
    vmImage: 'macOS-latest'
  steps:
  - task: NodeTool@0
    inputs:
      versionSource: 'spec'
      versionSpec: '18.x'
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.x'
      addToPath: true
      architecture: 'x86'
      
  - task: Bash@3
    displayName: Git Clone
    inputs:
      targetType: 'inline'
      script: |
        # Write your commands here      
        git clone -b build https://github.com/zeromq/zeromq.js.git

  - bash: | 
      npm install
    displayName: Install
    workingDirectory: zeromq.js

  # Ensure we have cmake on the mac machine
  - task: CMake@1
    inputs:
      cmakeArgs: --version

  - bash: | 
      npm run prebuild
    displayName: Install
    workingDirectory: zeromq.js
  - task: Bash@3
    displayName: ls
    inputs:
      workingDirectory: zeromq.js/prebuilds
      targetType: 'inline'
      script: |
        ls  

